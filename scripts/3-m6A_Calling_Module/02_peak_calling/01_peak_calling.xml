<tool id="Peak_Calling" name="Peak Calling">
  <description>from the m6A-Seq data</description>
  <command><![CDATA[
  /home/galaxy/miniconda3/envs/bio/bin/Rscript ${__tool_directory__}/01_peak_calling.R
    -fasta_file $Fasta
    -totalinput $TOTAL_INPUT
    -totalip $TOTAL_IP
    -inputfile $INPUT_TXT
    -ipfile $IP_TXT
    -outputfile $fastq0
    -fc $ratio
    -fdr $level
    -readsCount $readsCount
    -sliding_step $window
    -cpus $thread
  ]]></command>
  <inputs>
    <param name="Fasta" type="data" format="fasta,fna,fa"  multiple="false" label="Assembled transcript file" help=""/>

    <param name="IP_TXT" type="data" format="txt"  multiple="false" label="Input the ReadsCoverage file in IP sample" help=""/>
	<param name="INPUT_TXT" type="data" format="txt"  multiple="false" label="Input the ReadsCoverage file in input sample" help=""/>
  <param name="TOTAL_IP" type="data" format="txt"  multiple="false" label="Total mapped reads number in IP sample(alignmentSummary)" help=""/>
  <param name="TOTAL_INPUT" type="data" format="txt"  multiple="false" label="Total mapped reads number in input sample(alignmentSummary)" help=""/>

	<param name="level" type="float"  value="0.01"  label="FDR"/>
	<param name="ratio" type="float" value="1.5" label="Ratio (log2)" help="The ratio between the normalized mapped reads number in input and IP samples, respectively."/>
	<param name="thread" type="integer" value="1" max='6' min='1' label="Threads"/>
	<param name="readsCount" type="integer" value="1" label="The minimum number of reads count in IP sample"/>
	<param name="window" type="integer" value="25" label="The length of sliding window" />

  </inputs>
  <stdio>
	<exit_code range="1:"  level="fatal" description="Error Running combine collection to a file" />
  </stdio>
  <outputs> 
	<data name="fastq0" format="bed" label="peak.bed">
	</data>
  </outputs>
  <help>
<![CDATA[
.. class:: infomark

**What it does**

In this function,  peak calling was performed using **PEA** (Zhai *et al*, 2018)ï¼Œwhich used the SlidingWindow method with default options. To call m6A peaks, each transcript was scanned using a 100-bp sliding window with 25-bp steps.

-----

.. class:: infomark

**Inputs**

- **Input FASTA files:** Input assembled transcripts in FASTA format
- **Input the ReadsCoverage file in IP sample:**  IP ReadsCoverage file in TXT format
- **Input the ReadsCoverage file in input sample:**  input ReadsCoverage file in TXT format
- **Alignment summary file in IP sample:** **Alignment summary file in TXT format in IP sample generated by bowtie2**
- **Alignment summary file in input sample:** **Alignment summary file in TXT format in input sample generated by bowtie2**

-----

.. class:: infomark

**Parameters**

- **FDR**: p-value cutoff for peak detection
- **Ratio (log2)**: the ratio between the normalized mapped reads number in input and IP samples, respectively
- **ReadCount**: the minimum number of reads count in IP sample
- **window length**: This method splits the genome into x-bp bins, then each bin is tested using Fisher's exact test. 

-----

.. class:: infomark

**Outputs**

- **The enriched peak region matrix in BED format**

]]>

  </help>
   <citations>
        <citation type="doi">10.1093/bioinformatics/bty421</citation>
    </citations>
</tool>