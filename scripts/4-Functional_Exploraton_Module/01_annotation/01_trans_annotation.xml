<tool id="trans_annotation" name="Transcriptome Annotation">
  <description></description>
  <command><![CDATA[
      mkdir -p ${__tool_directory__}/$$
      && awk '/^>/ {getline seq; print $0":1-"length(seq)"(*)(0, 0)\n"seq}' $Fasta > ${__tool_directory__}/$$/tmp.fasta
      && source /home/galaxy/miniconda3/bin/activate /home/galaxy/miniconda3/envs/tf26
      && /home/galaxy/miniconda3/envs/tf26/bin/translationai 
          -I ${__tool_directory__}/$$/tmp.fasta
          -t ${thre_tis},${thre_tss}
      && /home/galaxy/miniconda3/envs/bio/bin/Rscript ${__tool_directory__}/01_translation_transfrag.R 
          -fasta_file $Fasta
          -dir ${__tool_directory__}/$$
      && /home/galaxy/miniconda3/envs/eggnog/bin/emapper.py
        --itype proteins -i ${__tool_directory__}/$$/tmp_PUlearning_pep.fa
        --output ${__tool_directory__}/$$
        --cpu ${thread} --usemem  -d  /home/galaxy/miniconda3/envs/eggnog/lib/python3.8/site-packages/data/eggnog_proteins.dmnd  -m diamond --override
      && mv ${__tool_directory__}/$$/tmp.fa_predORFs_0.5_0.5_cut.txt $trans_prediction
      && mv ${__tool_directory__}/$$/.emapper.annotations $annotation_result
      && rm -rf ${__tool_directory__}/$$
  ]]></command>
  <inputs>
	  <param name="Fasta" type="data" format="fasta,fna,fa"  multiple="false" label="Input the transfrags file" help=""/>
    <param name="thre_tis" type="float" value="0.5" label="Threshold k values for TIS prediction" help="If k > 1, output the top-k TISs in each sequence; else, output the score >= k TISs.(-t)"/>
    <param name="thre_tss" type="float" value="0.5" label="Threshold k values for TSS prediction" help="If k > 1, output the top-k TSSs in each sequence; else, output the score >= k TSSs.(-t)"/>
    <param name="thread" type="integer" value="1" min="1" max="4" label="Threads"/>
  </inputs>
  <stdio>
	  <exit_code range="1:"  level="fatal" description="Error Running combine collection to a file" />
	</stdio>
  <outputs>
	  <data name="trans_prediction" format="txt" label="translationai_prediction.txt">
	  </data>
	  <data name="annotation_result" format="txt" label="eggnog_annotation.txt">
    </data>

  </outputs>
<help>
.. class:: infomark

**What it does**

In this function, we utilized TranslationAI (Fan *et al*, 2023), a deep neural network to directly predict and analyze translation initiation (TIS) and termination sites (TSS) from transfrags. Functional annotation was performed useing eggNOG-mapper (v2.1.9 (Huerta-Cepas *et al*, 2017); database v5.0.2 (Huerta-Cepas *et al*, 2018)) to identify potential functions based on homology.

.. class:: infomark

**Inputs**

- **Epitranscriptome sequencing reads in FASTQ format**
- **Reference genome in FASTA format**

.. class:: infomark

**Outputs**

- Alignments in BAM format
- Alignment summary generated by bowtie2

</help>
    <citations>
        <citation type="doi">10.1101/2023.07.08.548206</citation>
        <citation type="doi">10.1093/molbev/msx148</citation>
        <citation type="doi">10.1093/nar/gky1085</citation>
    </citations>
</tool>